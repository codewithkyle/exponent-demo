{% extends "_base/page" %}

{% if entry.slug == settings.homepageEntry[0].slug and siteUrl != craft.app.request.absoluteUrl %}
    {% redirect siteUrl %}
{% endif %}

{% if not craft.app.request.isLivePreview %}
    {% do eagerLoadElements(entry, [
        'heroArea',
        'heroArea.homepageHeroCarousel',
        'heroArea.homepageHeroCarousel:image',
        'heroArea.heroImage',
        'contentMatrix',
        'contentMatrix.ctaGrid',
        'contentMatrix.ctaGrid:cards',
        'contentMatrix.ctaGrid:cards.icon',
        'contentMatrix.ctaCards',
        'contentMatrix.ctaCards:cards',
        'contentMatrix.ctaCards:cards.image',
        'contentMatrix.pullQuote',
        'contentMatrix.pullQuote:image',
        'contentMatrix.ctaBlogCards',
        'contentMatrix.ctaBlogCards:cards',
        'contentMatrix.ctaBlogCards:cards.image',
        'contentMatrix.ctaBlogCards:cards.categories',
        'contentMatrix.ctaBanner',
        'contentMatrix.ctaBanner:backgroundImage',
        'contentMatrix.storyBlock',
        'contentMatrix.storyBlock:image',
        'contentMatrix.descriptiveList',
        'contentMatrix.descriptiveList:lists',
        'contentMatrix.descriptiveList:lists.icon',
        'contentMatrix.statisticsShowcase',
        'contentMatrix.statisticsShowcase:cards',
        'contentMatrix.statisticsShowcase:cards.icon'
    ]) %}
{% endif %}

{% set data = {
    'hero': entry.heroArea[0],
    'sections': entry.contentMatrix,
} %}

{% block content %}
    {% if craft.imager.serverSupportsWebp() and craft.imager.clientSupportsWebp() %}
        {% set imageType = 'webp' %}
    {% else %}
        {% set imageType = 'jpg' %}
    {% endif %}
    {% cache using key entry.slug ~ "-" ~ imageType %}
        <article style="display:block;width:100%;">
            {% include "_heros/" ~ data.hero.type %}
            {% for section in data.sections %}
                {% include "_blocks/" ~ section.type|kebab %}
            {% endfor %}
        </article>
    {% endcache %}
{% endblock %}
