{% set isDebug = craft.app.request.getParam('debug') %}
{% set page = {
    'id': null,
    'revisionId': null,
    'uid': null,
} %}
{% if entry is defined %}
    {% set page = entry %}
{% elseif category is defined %}
    {% set page = category %}
{% endif %}

{# Tell the browser to cache this page for 30 days #}
{% set expiry = now|date_modify('+30 days') %}

{% header "Cache-Control: max-age=" ~ (expiry.timestamp - now.timestamp) %}
{% header "Pragma: cache" %}
{% header "Expires: " ~ expiry|date('D, d M Y H:i:s', 'GMT') ~ " GMT" %}
{% header "Access-Control-Expose-Headers: etag" %}
{% if page.uid %}
    {% header "ETag: " ~ page.uid ~ '-' ~ craft.pwa.getCache(page.id) %}
{% endif %}

{% spaceless %}
<!DOCTYPE html>
<html 
    lang="{{ currentSite.language }}" 
    state="hard-loading" 
    {% if isDebug and currentUser and currentUser['admin'] or craft.app.config.env == 'dev' or craft.app.config.env == 'staging'  %}
        debug="true"
    {% endif %} 
    data-csrf="{{ craft.app.request.csrfToken }}" 
    data-environment="{{ craft.app.config.env }}" 
    data-ga-id=""
>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
        <meta name="referrer" content="origin-when-cross-origin" />
        {% hook 'seo' %}
        
        <!-- Critical CSS -->
        <style>
            :root
            {
                font-size: 100%;
                
                --font: #333;
                --background: #fff;

                --loading-bar: #00BFFF;
                --loading-bar-background: #eee;
                --loading-background: #fafafa;
                --loading-font: #333;
            }

            @media (prefers-color-scheme: dark)
            {
                :root
                {
                    --font: #fff;
                    --background: #232323;
                    --loading-bar-background: #454545;
                    --loading-background: #232323;
                    --loading-font: #fff;
                }
            }

            *
            {
                position: relative;
                box-sizing: border-box;
                margin: 0;
                padding: 0;
                font-size: 1rem;
                line-height: 1;
                font-weight: inherit;
                font-style: normal;
                text-decoration: none;
				font-family: inherit;
				-webkit-tap-highlight-color: transparent;
            }

            html
            {
                height: 100vh;
                overflow-y: auto;
                width: 100vw;
                display: block;
            }

            body
            {
                margin: 0;
                padding: 0;
                background-color: var(--background);
                color: var(--font);
                display: block;
                min-height: 100%;
                width: 100%;
                font-size: 1rem;
                font-weight: 400;
                -webkit-text-size-adjust: 100%;
                font-family: system-ui, BlinkMacSystemFont, -apple-system, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            }

            ul li,
            ol li
            {
                line-height: 1.618;
                list-style-position: inside;
			}
			
			button
			{
				cursor: pointer;
				background: transparent;
				outline: none;
				border: none;
				user-select: none;
			}
        </style>

        <!-- Loading animations -->
        <style>
            page-loading
            {
                width: 100vw;
                height: 100vh;
                display: flex;
                position: fixed;
                top: 0;
                left: 0;
                justify-content: center;
                align-items: center;
                flex-flow: column wrap;
                background-color: var(--loading-background);
                color: var(--font);
                font-size: 1.25rem;
                z-index: 1000000;
                user-select: none;
                pointer-events: none;
                cursor: wait;
                text-align: center;
                visibility: hidden;
                opacity: 0;
                transition: all 150ms 150ms ease;
            }

            html[state="hard-loading"] page-loading
            {
                visibility: visible;
                opacity: 1;
            }

            page-loading span
            {
                line-height: 1.618;
                display: block;
                font-size: 1.125rem;
                font-weight: 400;
                font-family: system-ui, BlinkMacSystemFont, -apple-system, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
                white-space: nowrap;
                opacity: 0.87;
                color: var(--loading-font);
            }

            page-loading page-loading-bar
            {
                width: 200px;
                height: 4px;
                position: relative;
                background-color: var(--loading-bar);
                overflow: hidden;
                display: inline-block;
                box-shadow: inset 0 0 2px rgba(51,51,51,0.15);
            }

            page-loading page-loading-bar bar-one
            {
                left: -145%;
                position: absolute;
                box-sizing: border-box;
                width: 100%;
                height: 100%;
                animation: primaryBar 2s infinite linear;
            }

            page-loading page-loading-bar bar-one::before
            {
                content: "";
                background-color: var(--loading-bar-background);
                display: inline-block;
                box-sizing: border-box;
                position: absolute;
                width: 100%;
                height: 100%;
                animation: primaryScale 2s infinite linear;
            }

            page-loading page-loading-bar bar-two
            {
                left: -100%;
                position: absolute;
                width: 100%;
                box-sizing: border-box;
                height: 100%;
                animation: secondaryBar 2s infinite linear;
            }

            page-loading page-loading-bar bar-two::before
            {
                content: "";
                background-color: var(--loading-bar-background);
                display: inline-block;
                box-sizing: border-box;
                position: absolute;
                width: 100%;
                height: 100%;
                animation: secondaryScale 2s infinite linear;
            }

            page-loading resource-counter,
            page-loading resource-total
            {
                display: inline-block;
            }

            page-loading span.-slash
            {
                font-size:0.75rem;
                display:inline-block;
                margin:0 0.25rem;
                transform:translateY(-2px);
            }

            @keyframes primaryBar{
                0%{
                    transform: translateX(0);
                }
                20%{
                    transform: translateX(0);
                    animation-timing-function: cubic-bezier(.5,0,.70173,.49582);
                }
                59%{
                    transform: translateX(83.67142%);
                    animation-timing-function: cubic-bezier(.30244,.38135,.55,.95635);
                }
                100%{
                    transform: translateX(200.61106%);
                }
            }

            @keyframes secondaryBar{
                0%{
                    transform: translateX(0);
                    animation-timing-function: cubic-bezier(.15,0,.51506,.40969);
                }
                25%{
                    animation-timing-function: cubic-bezier(.31033,.28406,.8,.73371);
                    transform: translateX(37.65191%);
                }
                48.35%{
                    animation-timing-function: cubic-bezier(.4,.62704,.6,.90203);
                    transform: translateX(84.38617%);
                }
                100%{
                    transform: translateX(160.27778%);
                }
            }

            @keyframes primaryScale{
                0%{
                    transform: scaleX(.08);
                }
                36%{
                    animation-timing-function: cubic-bezier(.33473,.12482,.78584,1);
                    transform: scaleX(.08);
                }
                69%{
                    animation-timing-function: cubic-bezier(.06,.11,.6,1);
                    transform: scaleX(.66148);
                }
                100%{
                    transform: scaleX(.08);
                }
            }

            @keyframes secondaryScale{
                0%{
                    animation-timing-function: cubic-bezier(.20503,.05705,.57661,.45397);
                    transform: scaleX(.08);
                }
                19%{
                    animation-timing-function: cubic-bezier(.15231,.19643,.64837,1.00432);
                    transform: scaleX(.4571);
                }
                44%{
                    animation-timing-function: cubic-bezier(.25776,-.00316,.21176,1.38179);
                    transform: scaleX(.72796);
                }
                100%{
                    transform: scaleX(.08);
                }
            }
        </style>

		<!-- noscript CSS -->
        <noscript>
			<style>	
				page-loading {
					display: none;
				}

				body {
					padding: 6rem 1rem;
					background-color: #fafafa;
					color: rgba(51, 51, 51, 0.87);
				}

				main {
					width: 840px;
					max-width: 100%;
					margin: 0 auto;
				}

				article,
				section {
					display: block;
				}

				h1,
				h2,
				h3,
				p,
				ul,
				ol,
				img {
					margin-bottom: 2rem;
				}

				h1 {
					font-size: 3rem;
				}

				h2 {
					font-size: 2rem;
				}

				h3 {
					font-size: 1.5rem;
				}

				p {
					line-height: 1.618;
				}

				img {
					display: block;
					margin: 0 auto 2rem;
				}

				@media (prefers-color-scheme: dark) {
					body {
						background-color: #232323;
						color: #fff;
					}
				}
			</style>
        </noscript>

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script> -->

        <link rel="preload" href="{{ alias('@rootUrl')|trim('/') }}/assets/env.js" as="script" crossorigin="anonymous">
        <link rel="preload" href="{{ alias('@rootUrl')|trim('/') }}/assets/broadcaster.js" as="script" crossorigin="anonymous">
        <link rel="preload" href="{{ alias('@rootUrl')|trim('/') }}/assets/notify.js" as="script" crossorigin="anonymous">
        <script type="module" src="{{ alias('@rootUrl')|trim('/') }}/assets/runtime.js"></script>
		<script type="module" src="{{ alias('@rootUrl')|trim('/') }}/assets/pjax.js"></script>
    </head>
    <body>
        {# Full screen loading animation #}
        <page-loading>
            <div>
                <span>Loading page</span>
                <page-loading-bar>
                    <bar-one></bar-one>
                    <bar-two></bar-two>
                </page-loading-bar>
            </div>
        </page-loading>
        {# Infinite progress bar loading animation #}
        <soft-loading>
            <transition-bar-one></transition-bar-one>
            <transition-bar-two></transition-bar-two>
        </soft-loading>
        {# Page loading animation #}
        <page-transition>
            <page-transition-bar></page-transition-bar>
        </page-transition>
        {% block page %}{% endblock %}
    </body>
</html>
{% endspaceless %}
